import streamlit as st
import pandas as pd

st.set_page_config(page_title="26ë…„ ì£¼ì‹ì‹œì¥ ë¶„ì„", layout="wide")
st.title("ğŸ“ˆ 26ë…„ ì£¼ì‹ì‹œì¥ ë¶„ì„")

# ==================================================
# 1. ì‚°ì¶œ ìˆ˜ì‹ í‘œì‹œ
# ==================================================
with st.expander("ğŸ“ ì‚°ì¶œ ìˆ˜ì‹ (ê³„ì‚° ê¸°ì¤€)", expanded=True):
    st.markdown("""
- **ì—°ê°„ ìˆ˜ìµë¥ (%)**  
  `(í•´ë‹¹ì—°ë„ ë§ ì¢…ê°€ - ì „ë…„ë„ ë§ ì¢…ê°€) Ã· ì „ë…„ë„ ë§ ì¢…ê°€ Ã— 100`

- **ì˜ˆìƒ ìˆ˜ìµê¸ˆì•¡**  
  `íˆ¬ìê¸ˆì•¡ Ã— (26ë…„ ìˆ˜ìµë¥  Ã· 100)`

- **ì˜ˆìƒ ì´ ê¸ˆì•¡**  
  `íˆ¬ìê¸ˆì•¡ + ì˜ˆìƒ ìˆ˜ìµê¸ˆì•¡`
""")

# ==================================================
# 2. ì‹œì¥ ì„ íƒ
# ==================================================
market = st.radio(
    "ğŸ“Œ ì‹œì¥ ì„ íƒ",
    ["ë¯¸êµ­ ì£¼ì‹", "í•œêµ­ ì£¼ì‹"],
    horizontal=True
)

# ==================================================
# 3. ë°ì´í„° (ì•ˆì •ìš©)
# ==================================================
us_data = pd.DataFrame({
    "ì¢…ëª©": ["AAPL (ì• í”Œ)", "MSFT (ë§ˆì´í¬ë¡œì†Œí”„íŠ¸)", "NVDA (ì—”ë¹„ë””ì•„)", "AMZN (ì•„ë§ˆì¡´)", "TSLA (í…ŒìŠ¬ë¼)"],
    "ì•„ì´ì½˜": ["ğŸ", "ğŸªŸ", "ğŸ®", "ğŸ“¦", "ğŸš—"],
    "24": [30, 25, 60, 20, 45],
    "25": [40, 35, 80, 30, 55],
    "26": [120, 90, 180, 110, 160]
})

kr_data = pd.DataFrame({
    "ì¢…ëª©": ["005930 (ì‚¼ì„±ì „ì)", "000660 (SKí•˜ì´ë‹‰ìŠ¤)", "035420 (ë„¤ì´ë²„)", "051910 (LGí™”í•™)", "005380 (í˜„ëŒ€ì°¨)"],
    "ì•„ì´ì½˜": ["ğŸ“±", "ğŸ’¾", "ğŸŒ", "ğŸ§ª", "ğŸš—"],
    "24": [20, 35, 15, 10, 25],
    "25": [45, 60, 30, 25, 40],
    "26": [120, 180, 110, 95, 140]
})

df = us_data if market == "ë¯¸êµ­ ì£¼ì‹" else kr_data

# ==================================================
# 4. ì…ë ¥ ì˜ì—­ (ì••ì¶•)
# ==================================================
c1, c2, c3 = st.columns([1, 1, 2])

with c1:
    target = st.selectbox("ğŸ¯ ëª©í‘œ ìˆ˜ìµë¥  (%)", list(range(20, 210, 10)))

with c2:
    investment = st.number_input(
        "ğŸ’° íˆ¬ìê¸ˆì•¡",
        min_value=0,
        value=1000000,
        step=100000,
        format="%d"
    )

with c3:
    st.markdown(
        f"""
        **íˆ¬ìê¸ˆì•¡ ê¸°ì¤€ ê³„ì‚° ì˜ˆì‹œ**  
        - 26ë…„ ìˆ˜ìµë¥  100% â†’ {investment*2:,}ì›  
        - 26ë…„ ìˆ˜ìµë¥  150% â†’ {int(investment*2.5):,}ì›
        """
    )

# ==================================================
# 5. ì¶”ì²œ ì¢…ëª© í•„í„°
# ==================================================
filtered = df[
    (df["25"] > 0) &
    (df["26"] >= target)
].sort_values("26", ascending=False).head(5)

# ==================================================
# 6. ê²°ê³¼ ì¶œë ¥ (ê·¹ë„ ì••ì¶•)
# ==================================================
st.subheader("â­ ì¶”ì²œ ì¢…ëª© TOP 5")

if filtered.empty:
    st.warning("ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.")
else:
    st.markdown("ì•„ì´ì½˜ | ì¢…ëª© | 24ë…„ | 25ë…„ | 26ë…„ | ì˜ˆìƒìˆ˜ìµ | ì´ê¸ˆì•¡")
    st.markdown("---")

    for _, r in filtered.iterrows():
        profit = int(investment * r["26"] / 100)
        total = investment + profit

        c1, c2, c3, c4, c5, c6, c7 = st.columns([0.5, 3, 1, 1, 1, 2, 2])

        c1.markdown(r["ì•„ì´ì½˜"])
        c2.markdown(f"**{r['ì¢…ëª©']}**")
        c3.markdown(f"{r['24']}%")
        c4.markdown(f"{r['25']}%")
        c5.markdown(f"**{r['26']}%**")
        c6.markdown(f"{profit:,}ì›")
        c7.markdown(f"**{total:,}ì›**")

# ==================================================
# 7. ë‰´ìŠ¤ ë§í¬
# ==================================================
st.divider()
st.subheader("ğŸ“° ê´€ë ¨ ë‰´ìŠ¤")

for stock in filtered["ì¢…ëª©"]:
    link = f"https://www.google.com/search?q={stock}+ì£¼ì‹+ë‰´ìŠ¤"
    st.markdown(f"- **{stock}** â†’ [ë‰´ìŠ¤ ë³´ê¸°]({link})")
